<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html/Javascript/python; charset=utf-8" />
    <title>Ride@Wes</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <!-- Stylesheet -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/static/css/index.css" />
    <link rel="stylesheet" href="/static/css/bootstrap-responsive.min.css" />
      
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/themes/sunny/jquery-ui.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js"></script>
  </head>

  <body>{% csrf_token %}
      
      
      <div id="wrap"> <!-- wrap all content for fixed header/footer -->
          
      <div class="modal-header" id="mainTitle">
        <img src="../static/img/license-plate.jpg" id="titlePlate">
          <!-- http://acme.com/licensemaker/licensemaker.cgi?state=Connecticut&text=Wes+Ride&plate=1987&r=1520451124 -->
          <br><br>
        <p id="subtitle">THIS IS <img src="../static/img/y-sign.jpg" id="ysign"></p>
      </div>
          
      <div id="content">
      
      <div id="signin" class="loadSearch">
  
      <!-- Main Container -->
      <section>
        <div class="" id="loginModal">
        <div class="modal-body" id="loginBody">
          <ul class="nav nav-tabs">
            <li class="active"><a href="#logtab" data-toggle="tab">Login</a></li>
            <li><a href="#createtab" data-toggle="tab">Create Account</a><li>
          </ul>
  
          <div id="tabs" class="tab-content">
            <div class="tab-pane active in" id="logtab">
              <div class="container login" id="logContainer">
                <div class="row">
                  <div class="center offset4 span4 well">
                    <div id='loginerror' class="alert alert-box" style="display: none; ">
                      <button type="button" class="close" data-dismiss="alert">&times;</button>
                    </div>
                    <legend>Sign In</legend>
                      <input type="text" id="username" class="span4" name="username" placeholder="Email" />
                      <input type="password" id="password" class="span4" name="password" placeholder="Password  " />
                    <button id="login" type="submit" name="submit" class="btn btn-primary btn-block">Sign in</button>
                    <a href="#forgotbox" data-toggle="modal"><i></i>Forgot Password?</a  >
                  </div>
                </div>
              </div>
              
            </div>
              
            <div class="tab-pane fade" id="createtab">
              <div class="center offset4 span4 well">
              <div id="createerror" class="alert alert-box" style="display: none; ">
              <button type="button" class="close" data-dismiss="alert">&times;</button>
              </div>
                <label>Email</label>
                <div class='alert' style='display:none;' id='emailErrors'></div>
                <input id="addemail" type="text" value="" class="span4" placeholder="ted@wesleyan.edu" />
                <label>Password</label>
                <div class='alert' style='display:none;' id='passwordErrors'></div>
                <input id="addpassword" type="password" value="" class="span4" placeholder="Password (at least 8 characters)" />
                <label>Confirm Password</label>
                <div class='alert' style='display:none;' id='password1Errors'></div>
                <input id="addconfirmpassword" type="password" value="" class="span4" placeholder="Password" />
                <label>Name</label>
                <div class='alert' style='display:none;' id='nameErrors'></div>
                <input id="addname" type="text" value="" class="span4" placeholder="Name" />
                <label>Phone Number</label>
                <div class='alert' style='display:none;' id='phoneNumberErrors'></div>
                <input id="addphonenumber" type="text" value="" class="span4" placeholder="Phone Number" />
                <label>Class Year </label>
                <div class='alert' style='display:none;' id='classYearErrors'></div>
                <input id="addclassyear" type="text" value="" class="span4" placeholder="Class Year" />
  
                <div>
                  <button id="create" class="btn btn-primary">Create Account</button>
                </div>
            </div>
            </div>
          </div>
         </div>
            
        </div>
      </section>
    <!-- Main Container End -->

    <!-- Forgot Password Box -->
    <div id="forgotbox" class="modal hide fade in" style="display: none; ">
      <div id="forgoterror" class="alert alert-box" style="display: none; ">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
      </div>
      <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>
        <h3>Forgot Password</h3>
      </div>
      <div class="modal-body">
      <p>Enter your email to reset your password</p>
          <div class="controls control-row">
            <input id="forgotemail" name="forgotemail" type="text" class="span3" placeholder="Email" />
         </div>
      </div>
      <div>
        <a id="forgot" class="btn btn-primary">Submit</a>
      </div>
    </div>

    <!-- Contact Us Box -->
    <div id="contactbox" class="modal hide fade in" style="display: none; ">
      <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>
        <h3>Contact Us</h3>
      </div>
      <div class="modal-body">
      <p>Tell us what you think.</p>
          <div class="controls control-row">
            <input name="name" type="text" class="span3" placeholder="Name" />
          </div>
          <div class="controls control-row">
            <input name="username" type="text" class="span3" placeholder="username" />
          </div>
          <div class="controls">
            <textarea id="message" name="message" class="span5" placeholder="Your Message" rows="5"></textarea> 
          </div>
      </div>
      <div>
        <a href="#" class="btn btn-primary">Submit</a>
      </div>
    </div>
          
    </div>
    <!-- SIGN IN END-->


          
    <div id="search" class="otherpages">
          I am a
          <select id='isDriver'>
            <option value='driver'>Driver</option>
            <option value='passenger'>Passenger</option>
          </select>
        
          <div id="carsize">
              With <input type="number" name="numPassengers" min="1" max="6"> passenger seats
          </div>
        
          <p>Driving 

            <select id='direction'>
              <option value='fromWes'>from Wesleyan to</option>
              <option value='toWes'>to Wesleyan from</option>
            </select>
          </p>

          <input type="text" id="address" name="address" placeholder="Address" value="46 Wyllys Ave." />
          <input type="text" id="city" name="city" placeholder="City" value="Middletown" required />
            <select id="state" name="state" class="form-control" >
                <option value="AL">AL</option>
                <option value="AK">AK</option>
                <option value="AZ">AZ</option>
                <option value="AR">AR</option>
                <option value="CA">CA</option>
                <option value="CO">CO</option>
                <option selected value="CT">CT</option>
                <option value="DE">DE</option>
                <option value="DC">DC</option>
                <option value="FL">FL</option>
                <option value="GA">GA</option>
                <option value="HI">HI</option>
                <option value="ID">ID</option>
                <option value="IL">IL</option>
                <option value="IN">IN</option>
                <option value="IA">IA</option>
                <option value="KS">KS</option>
                <option value="KY">KY</option>
                <option value="LA">LA</option>
                <option value="ME">ME</option>
                <option value="MD">MD</option>
                <option value="MA">MA</option>
                <option value="MI">MI</option>
                <option value="MN">MN</option>
                <option value="MS">MS</option>
                <option value="MO">MO</option>
                <option value="MT">MT</option>
                <option value="NE">NE</option>
                <option value="NV">NV</option>
                <option value="NH">NH</option>
                <option value="NJ">NJ</option>
                <option value="NM">NM</option>
                <option value="NY">NY</option>
                <option value="NC">NC</option>
                <option value="ND">ND</option>
                <option value="OH">OH</option>
                <option value="OK">OK</option>
                <option value="OR">OR</option>
                <option value="PA">PA</option>
                <option value="RI">RI</option>
                <option value="SC">SC</option>
                <option value="SD">SD</option>
                <option value="TN">TN</option>
                <option value="TX">TX</option>
                <option value="UT">UT</option>
                <option value="VT">VT</option>
                <option value="VA">VA</option>
                <option value="WA">WA</option>
                <option value="WV">WV</option>
                <option value="WI">WI</option>
                <option value="WY">WY</option>
            </select>
        <br>
        <p>Leaving between
            <input type="time" id="time1" name="time1" value="12:00" />
            and
            <input type="time" id="time2" name="time2" value="14:00" />
            on 
            <input type="text" id="datepicker" name="departDate" />
        </p>
        <br>
        <button type="submit" id="searchRides" name="searchRides" >Search for a Ride</button>
        <button type="submit" id="createRide" name="createRide" >Create a Ride</button>
    </div>
    <!-- SEARCH END -->
          

    <div id="suggestions" class="otherpages loadSearch">

    <div class="panel-group" id="accordion">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
          Results
        </a>
      </h4>
    </div>
    <div id="collapseOne" class="panel-collapse collapse in">
      <div class="panel-body">
        <li id="searchresults"></li>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
          Create New Ride
        </a>
      </h4>
    </div>
    <div id="collapseTwo" class="panel-collapse collapse">
      <div class="panel-body">
        <div id="beforeCreate">
          <p>Can't find a ride that you want? Create a new ride!</p>
          <button type="submit" id="createRideAfter" name="createRideAfter" >Create a new Ride</button>
        </div>
        <div id="afterCreate" style="display: none;" >
          <p>Your ride has been created! You will receive e-mails as people sign up for your ride.</p>
        </div>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
          My Rides
        </a>
      </h4>
    </div>
    <div id="collapseThree" class="panel-collapse collapse">
      <div class="panel-body">
        rides rides rides
      </div>
    </div>
  </div>
</div>
        
        
        
        <button id="searchAgain">Search Again!</button>
        
    </div>
    <!-- SUGGESTIONS END -->
    
    </div> <!-- end main content -->
          
    <div id="footer">
        <p class="text-center">Created by Ted Kim, Max Dietz, Matthew Stein. </p>
        <p><a id="contactLink" href="#contactbox" data-toggle="modal"><i class="icon-envelope icon-black"></i> Contact Us</a></p>
    </div>
          
    </div> <!-- end wrap -->
          

    <!-- Javascript -->
    <script>
      $.fn.classList = function() {return this.className.split(/\s+/);};
       function getCookie(name) {
           var cookieValue = null;
           if (document.cookie && document.cookie != '') {
             var cookies = document.cookie.split(';');
             for (var i = 0; i < cookies.length; i++) {
               var cookie = jQuery.trim(cookies[i]);
               // Does this cookie string begin with the name we want?
               if (cookie.substring(0, name.length + 1) == (name + '=')) {
                   cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                   break;
               }
             }
           }
           return cookieValue;
         }
      
       $.ajaxSetup({
         beforeSend: function(xhr, settings) {
            xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
         }
       });

       $("#login").click(function() {
         $.post("/login/",
          { 'username': $("#username").val(),
            'password': $("#password").val(),
          }).always(function(r) {
            var resp = eval("(" + r.responseText + ")")
            if (resp.response.toString() != "ok") {
              $("#loginerror").text(resp.response).show();
            } else {
              $("#loginerror").hide();
              $("#signin").hide();
              $("#search").show();
            }
          })
        });

       $("#forgot").click(function() {
        $.post("/forgot-password/",
          { 'email' : $("#forgotemail").val(),
        }).always(function(r) {
          var resp = eval("(" + r.responseText + ")");
          $("#forgoterror").hide();
          if (resp.response.toString() != "ok") {
            $("#forgoterror").text(resp.response).show();
          }
        })
       });

       $("#create").click(function() {
        $.post("/users/add/",
          { 'email': $("#addemail").val(),
            'password' : $("#addpassword").val(),
            'password1' : $("#addconfirmpassword").val(),
            'name' : $("#addname").val(),
            'phone_number' : $("#addphonenumber").val(),
            'class_year' : $("#addclassyear").val(),
          }).always(function(resp) {
            $("#createerror").hide();
            $("#emailErrors").hide();
            $("#nameErrors").hide();
            $("#passwordErrors").hide();
            $("#password1Errors").hide();
            $("#phoneNumberErrors").hide();
            $("#classYearErrors").hide();
            if (resp.response && resp.response.toString() != 'ok') {
              if (resp.response.__all__)
                $("#createerror").text(resp.response.__all__[0]).show();
              if (resp.response.email)
                $("#emailErrors").text(resp.response.email[0]).show();
              if (resp.response.name)
                $("#nameErrors").text(resp.response.name[0]).show();
              if (resp.response.password)
                $("#passwordErrors").text(resp.response.password[0]).show();
              if (resp.response.password1)
                $("#password1Errors").text(resp.response.password1[0]).show();
              if (resp.response.phone_number)
                $("#phoneNumberErrors").text(resp.response.phone_number[0]).show();
              if (resp.response.class_year)
                $("#classYearErrors").text(resp.response.class_year[0]).show();
          } else {
              $.post("/login/",
            { 'username': $("#addemail").val(),
              'password': $("#addpassword").val(),
            }).always(function(r) {
              var resp = eval("(" + r.responseText + ")")
              if (resp.response.toString() != "ok") {
                $("#loginerror").text(resp.response).show();
              } else {
                $("#loginerror").hide();
                $("#signin").hide();
                $("#search").show();
              }
            })
          }
        })
       });
      $("#datepicker").val((new Date()).toLocaleDateString());

      $.getJSON("/users/info",function(r){
        if (!r.response) { $("#loginerror").hide();
                $("#signin").hide();
                $("#search").show();
         }});
        
      $("#searchRides").click(function() {
        window.driver = "True";
        window.direction = "True";
        window.time1 = $("#time1").val();
        window.time2 = $("#time2").val();
        window.address = $("#address").val();
        window.state = $("#state").val();
        window.city = $("#city").val();
        window.address = $("#address").val();
        var date = $("#datepicker").datepicker( "getDate" );
        var dateString = date.getFullYear() + "-" + String("00" + date.getMonth()).slice(-2) + "-" + String("00" + date.getDate()).slice(-2);
        time = dateString + " " + $("#time1").val();

        if ($("#isDriver").val() != "driver") {
          window.driver = "False";
        }

        if ($("#direction").val() != "toWes") {
          window.direction = "False";
        }

        $.getJSON("/search/?to_wes=" + window.direction +"&driver=" + window.driver + "&city=" + $("#city").val() +"&state=" + $("#state").val() + "&time=" + time).always(function(r) {
          console.log(r);
          for (var i = 0; i<r.length;i++){
            $("#searchresults").append("<li>Ride from " + r[i].start + " to " + r[i].end + " at " + r[i].time + " with " + (r[i].max_passengers - r[i].passengers.length) + " free seats.</li>");
          }
        });
        
        $("#search").hide();
        $("#suggestions").show();
      });

      $("#createRideAfter").click(function() {
        var start_state = "CT";
        var start_city = "Middletown";
        var end_state = "CT";
        var end_city = "Middletown";
        var start_address = "45 Wyllys";
        var end_address = "45 Wyllys";

        if (window.direction == "toWes") {
          start_state = window.state;
          start_city = window.city;
          start_address = window.address;
        } else {
          end_state = window.state;
          end_city = window.city;
          end_address = window.address;
        }
        if (window.driver == "driver") {
          driver = "True"
        }

        var address = $("#address").val();
        var date = $("#datepicker").datepicker("getDate");
        var dateString = date.getFullYear() + "-" + String("00" + date.getMonth()).slice(-2) + "-" + String("00"+date.getDate()).slice(-2);
        var time1 = dateString + " " + window.time1;
        var time2 = dateString + " " + window.time2;

        $.post("/rides/create/",
        { 'driver' : window.driver,
          'start_state' : start_state,
          'start_city' : start_city,
          'end_state' : end_state,
          'end_city' : end_city,
          'start_address' : start_address,
          'end_address' : end_address,
          'leave_time_start' : time1,
          'leave_time_end' : time2,
        }).always(function(r) {
           console.log(r);
        })
        $("#beforeCreate").hide();
        $("#afterCreate").show();
      });
        

      $("#createRide").click(function() {
        var driver = "False"
        var start_state = "CT"
        var start_city = "Middletown"
        var end_state = "CT"
        var end_city = "Middletown"
        var start_address = "45 Wyllys"
        var end_address = "45 Wyllys"
        if ($("#direction").val() == "toWes") {
          start_state = $("#state").val();
          start_city = $("#city").val();
          start_address = $("#address").val();
        } else {
          end_state = $("#state").val();
          end_city = $("#city").val();
          end_address = $("#address").val();
        }
        if ($("#isDriver").val() == driver) {
          driver = "True"
        }

        var address = $("#address").val();
        var date = $("#datepicker").datepicker("getDate");
        var dateString = date.getFullYear() + "-" + String("00" + date.getMonth()).slice(-2) + "-" + String("00"+date.getDate()).slice(-2);
        var time1 = dateString + " " + $("#time1").val();
        var time2 = dateString + " " + $("#time2").val();

        $.post("/rides/create/",
        { 'driver' : driver,
          'start_state' : start_state,
          'start_city' : start_city,
          'end_state' : end_state,
          'end_city' : end_city,
          'start_address' : start_address,
          'end_address' : end_address,
          'leave_time_start' : time1,
          'leave_time_end' : time2,
        }).always(function(r) {
           console.log(r);
        })
      });
        
      $("#isDriver").change(function() {
          if ($("#isDriver").val()=="driver") {
              $("#carsize").show();
          } else {
              $("#carsize").hide();
          };
      });
          
      $("#searchAgain").click(function() {
          $("#suggestions").hide();
          $("#search").show();
          $("#beforeCreate").show();
          $("#afterCreate").hide();
      });

      $(function() {
        $("#datepicker").datepicker();
      });

    </script>
  </body>
</html>
